### 1. 矛盾样本现象
一个常常会出现、但传统的machine learning理论却鲜有提及的现象是，训练集中会出现矛盾样本：x相同但y取值不同。
例如，**同一个用户很短时间里面看了同一个广告2次，一次发生了点击、另一次没有，而在这个时间段里面特征x的取值没有发生任何变化**（这是很有可能的，事实上很多实际应用中x都是以静态特征为主，缺乏反映用户状态的实时信息）。
这种矛盾样本现象常会引起初学者的困扰。

矛盾样本的根源，来自第二节对问题的简化操作：“假设E(tehta)跟单个事件E本身无关，仅跟事件的特征有关”。换句话说，我们强行抹掉了每一个独立事件本身的属性，认为所有事件独立同分布。
如果把每个事件唯一区分，如精确到纳秒的事件发生时间作为特征加入到x中，那矛盾样本自然就解开了。
换个角度来看，**矛盾样本的存在说明我们的特征丢掉了原始问题的部分信息，导致训练集是带有噪声的，进而导致模型的准确率永远不可能达到100%。** 
事实上在传统的机器学习理论中，因数据存在噪声分类器有个最小错误率的界，即**贝叶斯错误率**（Bayes error rate）。

有意思的是，跟上一节阐述的“不同模型形式选择差异性代表不同假设跟真实情况逼近程度的差异”类似，**特征的设计其实是从另外一个角度引入了对问题的逼近误差**。
原始的问题中，每一个事件都是独一无二的，换句话说不应该存在矛盾样本。 p(y=1|x) = f(x) 这个建模框架中，x的设计决定了简化问题的能力天花板，f的设计决定了逼近天花板的程度。

### 2. 模型性能评估器的选择
另一个常见问题是，为什么CTR模型的性能度量不采用常见的分类器准确率而是AUC。
不用准确率的原因大部分同学都能想到：CTR任务正负样本比例倾斜严重，模型对正样本预测全错的情况下准确率都非常高，换句话说，准确率的评估分辨率太低。使用AUC的原因则相对来说冷僻，这里解释下。

先回到本质，两个CTR模型的好坏从什么角度进行比较？我们没法在微观层面对每一个样本的预测值进行度量，一个可行的选择是从宏观层面对样本的比较关系进行度量。
**一个样本如果实际发生了点击，那么Y=1 的预测概率应该大于Y=0 的预测概率；反之亦然。进一步放宽些，我们希望数据集中，所有正类样本的预测score 大于负类样本，也就是模型的预测序尽可能逼近真实序。**
恰好统计领域**有一种假设检验叫Wilcoxon-Mann-Witney Test** ，它测试的是任意给一个正类样本和一个负类样本，正类样本的score 有多大概率大于负类样本的score。 
有牛人证明了**AUC跟Wilcoxon-Mann-Witney Test等价**，从而AUC的物理意义就很清晰了：**“任意给一个正类样本和一个负类样本，正类样本的score大于负类样本的score” 的概率值**。

再回过头来看，**CTR建模从根源上就是对原始问题的简化产物**。
**既然我们都不知道CTR真实值，那么绝对意义上的预测准确评估也就没有意义**，退而求其次，对观测到的数据度量模型预测的**结果序**，就是个还不错的选择了。
当然，除了AUC之外，我们还可以选择其余的评估方式比如lift等，它们对应于其它的物理含义，这里不做展开了。

### 3. 理论AUC上界
讲完了AUC就必须要谈谈另一个非常重要的概念：理论AUC上界。

先讲下如何计算：对于给定的训练数据集 {(x, y)}，由于矛盾样本的存在，一定有同一个x但不同y的情况。
对数据集做个归并操作：**所有x相同的样本，统计其CTR 值（统计N个重复样本里面y=1的个数T，CTR=T/N；如果x不存在重复，即N=1时，CTR=y即可），将这个值作为一个理论最优分类器的预测值，计算此时模型的AUC，得到的就是理论AUC上界**。
AUC上界对应于传统机器学习里的贝叶斯错误率，是有噪声数据下模型学习能够达到的最高水平。

从计算过程可以看出，**理论AUC上界度量的其实是样本中的混淆度（即矛盾样本出现的程度）**，它是给定数据集后模型能力的天花板，可以用来判断模型迭代的边际收益。
本质上，**理论AUC上界取决于特征的设计**。举个例子，**如果特征仅仅跟AD有关，与用户或者场景信息无关，这个时候模型其实就退化为一个简单的、广告维度的统计模型，非个性化，显然在这种特征空间下，模型能够达到的AUC天花板将远低于个性化的情况。**

另一方面，过高的理论AUC上界也不是好事。例如，将每一个样本id加入到特征里面，原则上理论AUC=1。但这种过细的、不具备泛化能力的特征，会对模型的学习过程造成强烈的干扰，尤其是对DNN这样解空间巨大、局部点遍布的函数簇，反而可能导致模型的性能下降。

### 4. 核心结论
本质上，**理论AUC上界取决于特征的设计**。举个例子，**如果特征仅仅跟AD有关，与用户或者场景信息无关，这个时候模型其实就退化为一个简单的、广告维度的统计模型，非个性化，显然在这种特征空间下，模型能够达到的AUC天花板将远低于个性化的情况。**
因此个性化比非个性化带来的点击率预估收益更大
