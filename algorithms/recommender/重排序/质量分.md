## 1. 不同类目下数据归一化，得到最终量纲一致的质量分

```python
import pandas as pd
from sklearn.preprocessing import MinMaxScaler

# 假设有一个商品数据 DataFrame
data = pd.DataFrame({
    'item_id': [101, 102, 103, 104, 105, 106, 107, 108, 109, 110],
    'category': ['A', 'A', 'A', 'A', 'A', 'B', 'B', 'B', 'B', 'B'],
    'rating': [4.5, 4.0, 3.5, 4.8, 4.2, 3.8, 4.1, 3.9, 4.3, 4.0],
    'review_count': [100, 150, 80, 200, 120, 90, 110, 130, 140, 100],
    'sales_volume': [500, 600, 300, 800, 450, 400, 500, 600, 700, 550],
    'return_rate': [0.05, 0.10, 0.15, 0.02, 0.08, 0.07, 0.05, 0.06, 0.04, 0.03],
    'complaint_rate': [0.01, 0.02, 0.03, 0.01, 0.02, 0.02, 0.01, 0.03, 0.01, 0.02],
    'description_consistency': [0.9, 0.85, 0.8, 0.95, 0.88, 0.87, 0.9, 0.85, 0.88, 0.86],
    'shipping_speed': [2, 3, 4, 1, 2, 3, 2, 4, 1, 3]
})

# 定义各维度的权重
weights = {
    'rating': 0.3,
    'review_count': 0.2,
    'sales_volume': 0.2,
    'return_rate': 0.1,
    'complaint_rate': 0.1,
    'description_consistency': 0.05,
    'shipping_speed': 0.05
}

# 需要标准化的列
columns_to_normalize = ['rating', 'review_count', 'sales_volume', 'return_rate', 'complaint_rate', 'description_consistency', 'shipping_speed']

# 按商品类目分组
grouped = data.groupby('category')

# 创建一个空的 DataFrame 来存储归一化后的数据
normalized_data = pd.DataFrame()

# 对每个类目进行归一化
for name, group in grouped:
    scaler = MinMaxScaler()
    group[columns_to_normalize] = scaler.fit_transform(group[columns_to_normalize])
    normalized_data = pd.concat([normalized_data, group])

# 计算综合质量分
normalized_data['quality_score'] = (
    normalized_data['rating'] * weights['rating'] +
    normalized_data['review_count'] * weights['review_count'] +
    normalized_data['sales_volume'] * weights['sales_volume'] +
    (1 - normalized_data['return_rate']) * weights['return_rate'] +  # 退货率越低越好
    (1 - normalized_data['complaint_rate']) * weights['complaint_rate'] +  # 投诉率越低越好
    normalized_data['description_consistency'] * weights['description_consistency'] +
    (1 - normalized_data['shipping_speed']) * weights['shipping_speed']  # 物流速度越快越好
)

# 按 item_id 和 quality_score 显示结果
print(normalized_data[['item_id', 'category', 'quality_score']].sort_values(by='quality_score', ascending=False))
```
